<!DOCTYPE html>


<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Interrupts &mdash; The Linux Kernel  documentation</title>
    
    <link rel="stylesheet" href="../_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="../_static/styles.css" type="text/css" />
    <link rel="stylesheet" href="../_static/single.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    
    
    <link rel="stylesheet" href="../_static/asciinema-player.css" type="text/css" />
    <link rel="stylesheet" href="../_static/theme_overrides.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/asciinema-player.js"></script>
    <script type="text/javascript" src="../_static/common.js"></script>
    
    <script type="text/javascript" src="../_static/slides.js"></script>
    <script type="text/javascript" src="../_static/sync.js"></script>
    <script type="text/javascript" src="../_static/controller.js"></script>
    <script type="text/javascript" src="../_static/init.js"></script>
    
    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="top" title="The Linux Kernel  documentation" href="../index.html" />
    <link rel="next" title="Symmetric Multi-Processing" href="smp.html" />
    <link rel="prev" title="System Calls" href="syscalls.html" /> 
  </head>
  <body>

<section
   id="slide_container"
   class='slides layout-regular'>


  
<article class="admonition-interrupts slide level-2">

<h2>Interrupts</h2>

<ul class="simple">
<li>Interrupts and exceptions (x86)</li>
<li>Interrupts and exceptions (Linux)</li>
<li>Deferrable work</li>
<li>Timers</li>
</ul>




</article>
<article class="admonition-interrupts slide level-2">

<h2>Interrupts</h2>

<ul class="simple">
<li><strong>synchronous</strong>, generated by executing an instruction</li>
<li><strong>asynchronous</strong>, generated by an external event</li>
<li><strong>maskable</strong><ul>
<li>can be ignored</li>
<li>signalled via INT pin</li>
</ul>
</li>
<li><strong>non-maskable</strong><ul>
<li>cannot be ignored</li>
<li>signalled via NMI pin</li>
</ul>
</li>
</ul>




</article>
<article class="admonition-exceptions slide level-2">

<h2>Exceptions</h2>

<ul class="simple">
<li>processor detected<ul>
<li><strong>faults</strong></li>
<li><strong>traps</strong></li>
<li><strong>aborts</strong></li>
</ul>
</li>
<li>programmed<ul>
<li><strong>int n</strong></li>
</ul>
</li>
</ul>




</article>
<article class="admonition-hardware-pic slide level-2">

<h2>Hardware (PIC)</h2>

<img alt="../_images/ditaa-f2e7fcf366f75599766f77babb74ffebbc7f79e3.png" src="../_images/ditaa-f2e7fcf366f75599766f77babb74ffebbc7f79e3.png" />




</article>
<article class="admonition-hardware-apic slide level-2">

<h2>Hardware (APIC)</h2>

<img alt="../_images/ditaa-f0124fcd03ddd32134f414c160e247355ab306bc.png" src="../_images/ditaa-f0124fcd03ddd32134f414c160e247355ab306bc.png" />




</article>
<article class="admonition-enabling-disabling-the-interrupts slide level-2">

<h2>Enabling/disabling the interrupts</h2>

<ul class="simple">
<li>at the PIC level<ul>
<li>programming the PIC</li>
<li>PIC can be programmed to disable a given IRQ line</li>
</ul>
</li>
<li>at the CPU level</li>
</ul>
<blockquote>
<div><ul class="simple">
<li>cli (CLear Interrupt flag)</li>
<li>sti (SeT Interrupt flag)</li>
</ul>
</div></blockquote>




</article>
<article class="admonition-interrupt-descriptor-table slide level-2">

<h2>Interrupt Descriptor Table</h2>

<ul class="simple">
<li>it is used as a jump table by the CPU when a given vector is triggered</li>
<li>it is an array of 256 x 8 bytes entries</li>
<li>may reside anywhere in physical memory</li>
<li>processor locates IDT by the means of IDTR</li>
</ul>




</article>
<article class="admonition-linux-irq-vector-layout slide level-2">

<h2>Linux IRQ vector layout</h2>

<img alt="../_images/ditaa-dc1532523c503b0c569468d4ed1d7aeb11ed0ed0.png" src="../_images/ditaa-dc1532523c503b0c569468d4ed1d7aeb11ed0ed0.png" />




</article>
<article class="admonition-interrupt-descriptor-table-entry-gate slide level-2">

<h2>Interrupt descriptor table entry (gate)</h2>

<img alt="../_images/ditaa-a9d35ab5597ae26c7755a800c13ff62d6b506ebd.png" src="../_images/ditaa-a9d35ab5597ae26c7755a800c13ff62d6b506ebd.png" />




</article>
<article class="admonition-interrupt-handler-address slide level-2">

<h2>Interrupt handler address</h2>

<img alt="../_images/ditaa-9b2dd926bf730364e2ca37aeea66fea341a741bf.png" src="../_images/ditaa-9b2dd926bf730364e2ca37aeea66fea341a741bf.png" />




</article>
<article class="admonition-interrupt-handler-stack slide level-2">

<h2>Interrupt handler stack</h2>

<img alt="../_images/ditaa-1e5c09a5a3c85a247e3e154c2ab664ba5ebc134c.png" src="../_images/ditaa-1e5c09a5a3c85a247e3e154c2ab664ba5ebc134c.png" />




</article>
<article class="admonition-interrupt-execution slide level-2">

<h2>Interrupt execution</h2>

<ul>
<li><p class="first">check current privilege level</p>
</li>
<li><p class="first">if need to change privilege level</p>
<blockquote>
<div><ul class="simple">
<li>change stack with the one associated with new privilege</li>
<li>save old stack information on the new stack</li>
</ul>
</div></blockquote>
</li>
<li><p class="first">save EFLAGS, CS, EIP on stack</p>
</li>
<li><p class="first">save error code on stack in case of an abort</p>
</li>
<li><p class="first">execute interrupt handler</p>
</li>
</ul>




</article>
<article class="admonition-returning-from-an-interrupt slide level-2">

<h2>Returning from an interrupt</h2>

<ul class="simple">
<li>pop the eror code (in case of an abort)</li>
<li>use IRET<ul>
<li>pops CS, EIP, EFLAGS</li>
<li>if privilege level changed returns to the old stack and old privilege level</li>
</ul>
</li>
</ul>




</article>
<article class="admonition-interrupt-exception-nesting slide level-2">

<h2>Interrupt/Exception nesting</h2>

<img alt="../_images/ditaa-e64238e31c9d1500c15e6d92c6a543aef95515aa.png" src="../_images/ditaa-e64238e31c9d1500c15e6d92c6a543aef95515aa.png" />




</article>
<article class="admonition-interrupt-context slide level-2">

<h2>Interrupt context</h2>

<blockquote>
<div><ul class="simple">
<li>runs as a result of an IRQ (not of an exception)</li>
<li>there is no ‘process’ context associated</li>
<li>can’t trigger a context switch<ul>
<li>no sleep</li>
<li>no schedule</li>
<li>no user memory access</li>
</ul>
</li>
</ul>
</div></blockquote>




</article>
<article class="admonition-interrupt-handling slide level-2">

<h2>Interrupt handling</h2>

<img alt="../_images/ditaa-5a402cd7f81a0ddbe1a435bc3ab7949828f731f0.png" src="../_images/ditaa-5a402cd7f81a0ddbe1a435bc3ab7949828f731f0.png" />




</article>
<article class="admonition-deferrable-actions-in-linux slide level-2">

<h2>Deferrable actions in Linux</h2>

<blockquote>
<div><ul class="simple">
<li>implemented using deferrable functions</li>
<li>softIRQ<ul>
<li>runs in interrupt context</li>
<li>statically allocated</li>
<li>same handler may run in parallel on multiple cores</li>
</ul>
</li>
<li>tasklet<ul>
<li>runs in interrupt context</li>
<li>can be dinamically allocated</li>
<li>same handler runs are serialized</li>
</ul>
</li>
<li>workqueues<ul>
<li>run in process context</li>
</ul>
</li>
</ul>
</div></blockquote>




</article>
<article class="admonition-soft-irq slide level-2">

<h2>Soft IRQ</h2>

<blockquote>
<div><ul class="simple">
<li>init: open_softirq()</li>
<li>activation: raise_softirq()</li>
<li>execution: do_softirq()</li>
<li>it runs<ul>
<li>after an interrupt handler</li>
<li>from the ksoftirqd kernel thread</li>
</ul>
</li>
</ul>
</div></blockquote>




</article>
<article class="admonition-types-of-soft-irq slide level-2">

<h2>Types of soft IRQ</h2>

<blockquote>
<div><ul class="simple">
<li>HI_SOFTIRQ</li>
<li>TIMER_SOFTIRQ</li>
<li>NET_TX_SOFTIRQ</li>
<li>NET_RX_SOFTIRQ</li>
<li>BLOCK_SOFTIRQ</li>
<li>TASKLET_SOFTIRQ</li>
<li>HRTIMER_SOFTIRQ</li>
</ul>
</div></blockquote>




</article>
<article class="admonition-ksoftirqd slide level-2">

<h2>ksoftirqd</h2>

<blockquote>
<div><ul class="simple">
<li>minimum priority kernel thread</li>
<li>runs self raised softirqs</li>
<li>trade-off between softirqs and process/kernel threads</li>
</ul>
</div></blockquote>




</article>
<article class="admonition-tasklets slide level-2">

<h2>Tasklets</h2>

<blockquote>
<div><ul class="simple">
<li>implemented on top of soft IRQ<ul>
<li>TASKLET_SOFITIRQ, HI_SOFTIRQ</li>
</ul>
</li>
<li>init: tasklet_init</li>
<li>activation: tasklet_schedule</li>
<li>masking: tasklet_disable(), tasklet_enable()</li>
</ul>
</div></blockquote>




</article>
<article class="admonition-workqueues slide level-2">

<h2>Workqueues</h2>

<blockquote>
<div><ul class="simple">
<li>implemented on top of kernel threads<ul>
<li>TASKLET_SOFITIRQ, HI_SOFTIRQ</li>
</ul>
</li>
<li>init: INIT_WORK</li>
<li>activation: schedule_work()</li>
</ul>
</div></blockquote>




</article>
<article class="admonition-timers slide level-2">

<h2>Timers</h2>

<blockquote>
<div><ul class="simple">
<li>implemented on top of TIMER_SOFTIRQ</li>
<li>init: setup_timer</li>
<li>activation: mod_timer</li>
</ul>
</div></blockquote>




</article>

</section>

<section id="slide_notes">

</section>

  </body>
</html>